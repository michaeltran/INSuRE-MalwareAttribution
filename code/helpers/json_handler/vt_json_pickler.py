# stdlib imports
import json
import glob
import os
import pickle
imprty sys

# package imports
from jsonvectorizer import utils


class VtJsonPickler:
    def __init__(
        self, json_path="../../data/static_vt/compact/*/*.json", pickle_path="vtjs.pkl"
    ):
        self.json_path = json_path
        self.pickle_path = pickle_path

    def pickle_vt(self):
        files = glob.glob(self.json_path)

        docs = []
        count = 0
        print("\n This may take some time")
        for file in files:
            count += 1
            with utils.fopen(file) as f:
                for line in f:
                    doc = json.loads(line)
                    docs.append(doc)
            print("\n JSON DOC #", str(count))
            print("DOC NAME: ", file)

        with open(self.pickle_path, "wb") as f:
            print("Starting pickling ")
            pickle.dump(docs, f)
        print("Done Pickling All VT JSON to One Doc ")

    def unpickle_vt(self):
        with open(self.pickle_path, "rb") as f:
            return pickle.load(f)
